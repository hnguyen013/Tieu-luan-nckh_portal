{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>{{ project.title }}</title>
    <link rel="stylesheet" href="{% static 'portal/css/public_home.css' %}">
    <link rel="stylesheet" href="{% static 'portal/css/project_detail.css' %}">
</head>
<body>

<header class="main-header">
    <div class="container header-inner">
        <div class="logo">NCKH Portal</div>
        <a href="{% url 'portal:public-project-list' %}" class="btn-back">← Quay lại</a>
    </div>
</header>

<section class="project-detail">
    <div class="container">

        <div class="detail-card">
            <h2 class="detail-title">Thông tin đề tài</h2>

            <table class="detail-table">
                <tr>
                    <th>Mã đề tài</th>
                    <td>{{ project.code }}</td>
                </tr>
                <tr>
                    <th>Tên đề tài</th>
                    <td>{{ project.title }}</td>
                </tr>
                <tr>
                    <th>Cấp đề tài</th>
                    <td>{{ project.project_level }}</td>
                </tr>
                <tr>
                    <th>Lĩnh vực</th>
                    <td>{{ project.research_field }}</td>
                </tr>
                <tr>
                    <th>Đơn vị chủ trì</th>
                    <td>{{ project.host_organization }}</td>
                </tr>
                <tr>
                    <th>Đơn vị thực hiện</th>
                    <td>{{ project.implementing_organization }}</td>
                </tr>
                <tr>
                    <th>Loại đề tài</th>
                    <td>{{ project.project_type.name }}</td>
                </tr>
                <tr>
                    <th>Đơn vị quản lý</th>
                    <td>{{ project.faculty.name }}</td>
                </tr>
                <tr>
                    <th>Năm học</th>
                    <td>{{ project.academic_year.name }}</td>
                </tr>
                <tr>
                    <th>Thời gian</th>
                    <td>
                        {{ project.start_year|date:"d/m/Y" }} → {{ project.end_year|date:"d/m/Y" }}
                    </td>
                </tr>
                <tr>
                    <th>Kinh phí</th>
                    <td>
                        {% if project.budget is not None %}
                            {{ project.budget }}
                        {% else %}
                            —
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Phân loại</th>
                    <td>{{ project.category }}</td>
                </tr>
                <tr>
                    <th>Tình trạng</th>
                    <td>{{ project.get_status_display }}</td>
                </tr>

                {% if project.objectives %}
                <tr>
                    <th>Mục tiêu</th>
                    <td>{{ project.objectives }}</td>
                </tr>
                {% endif %}

                {% if project.summary %}
                <tr>
                    <th>Nội dung</th>
                    <td>{{ project.summary }}</td>
                </tr>
                {% endif %}
            </table>
        </div>

        {# ✅ THÊM CARD: KẾT QUẢ CHẤM #}
        <div class="detail-card" style="margin-top: 16px;">
            <h2 class="detail-title">Kết quả chấm</h2>

            {% if council %}
                <table class="detail-table">
                    <tr>
                        <th>Mã hội đồng</th>
                        <td>{{ council.code }}</td>
                    </tr>
                    <tr>
                        <th>Tên hội đồng</th>
                        <td>{{ council.name }}</td>
                    </tr>
                    <tr>
                        <th>Ngày chấm</th>
                        <td>
                            {% if council.grading_date %}
                                {{ council.grading_date|date:"d/m/Y" }}
                            {% else %}
                                —
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Điểm tổng</th>
                        <td>
                            {% if council.total_score is not None %}
                                {{ council.total_score }}
                            {% else %}
                                Chưa có điểm
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Kết quả</th>
                        <td>
                            {% if council.total_score is None %}
                                —
                            {% else %}
                                {{ council.result }}
                            {% endif %}
                        </td>
                    </tr>
                </table>

                <h3 style="margin-top: 12px;">Điểm thành phần</h3>
                <table class="detail-table">
                    <tr>
                        <th>MGV</th>
                        <th>Họ tên</th>
                        <th>Vai trò</th>
                        <th>Điểm</th>
                    </tr>
                    {% for m in council.members.all %}
                        <tr>
                            <td>{{ m.lecturer.mgv }}</td>
                            <td>{{ m.lecturer.full_name }}</td>
                            <td>{{ m.role }}</td>
                            <td>
                                {% if m.score is not None %}
                                    {{ m.score }}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4">Chưa có thành viên hội đồng.</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p style="margin-top: 6px;">Chưa có hội đồng chấm cho đề tài này.</p>
            {% endif %}
        </div>

    </div>
</section>

</body>
</html>
