{% extends "portal/admin_base.html" %}

{% block title %}Danh sách sinh viên{% endblock %}
{% block menu_students_active %} active{% endblock %}
{% block page_header %}Quản lý sinh viên{% endblock %}
{% block breadcrumb %}Trang chủ / Sinh viên{% endblock %}

{% block content %}

    <div class="list-header">
        <h2>Danh sách sinh viên</h2>
        <a href="{% url 'portal:admin-student-create' %}" class="btn-primary">
            + Thêm sinh viên
        </a>
    </div>

    <form method="get" class="form-inline" style="margin-bottom: 12px; gap: 8px; flex-wrap: wrap;">

        <input type="text"
               name="q"
               placeholder="Tìm MSSV / Họ tên / Ngành / Email"
               value="{{ q }}"
               style="min-width: 280px;">

        <select name="faculty_id">
            <option value="">— Chọn khoa —</option>
            {% for f in faculties %}
                <option value="{{ f.id }}" {% if faculty_id == f.id|stringformat:"s" %}selected{% endif %}>
                    {{ f.name }}
                </option>
            {% endfor %}
        </select>

        <select name="course_id">
            <option value="">— Chọn khóa học —</option>
            {% for c in courses %}
                <option value="{{ c.id }}" {% if course_id == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.code }}
                </option>
            {% endfor %}
        </select>

        <select name="status">
            <option value="">— Tình trạng —</option>
            {% for val, label in status_choices %}
                <option value="{{ val }}" {% if status == val %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-secondary">Lọc</button>
        <a href="{% url 'portal:admin-student-list' %}" class="btn-secondary" style="text-decoration:none;">Xóa lọc</a>
    </form>

    <table class="table">
        <thead>
        <tr>
            <th>MSSV</th>
            <th>Họ tên</th>
            <th>Ngày sinh</th>
            <th>Giới tính</th>
            <th>Ngành</th>
            <th>Khoa</th>
            <th>Khóa</th>
            <th>Email</th>
            <th>Tình trạng</th>
            <th style="width: 150px;">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        {% for s in students %}
            <tr>
                <td>{{ s.mssv }}</td>
                <td>{{ s.full_name }}</td>
                <td>{{ s.date_of_birth|date:"d/m/Y" }}</td>
                <td>{{ s.get_gender_display }}</td>
                <td>{{ s.major.name }}</td>
                <td>{{ s.faculty.name }}</td>
                <td>{{ s.course.name }}</td>
                <td>{{ s.email }}</td>
                <td>
                    {% if s.status == "studying" %}
                        <span class="badge badge-success">{{ s.get_status_display }}</span>
                    {% elif s.status == "graduated" %}
                        <span class="badge badge-info">{{ s.get_status_display }}</span>
                    {% else %}
                        <span class="badge badge-warning">{{ s.get_status_display }}</span>
                    {% endif %}
                </td>
                <td class="actions">
                    <a href="{% url 'portal:admin-student-edit' s.id %}">Sửa</a>
                    |
                    <a href="{% url 'portal:admin-student-delete' s.id %}"
                       onclick="return confirm('Xóa sinh viên {{ s.mssv }} - {{ s.full_name }}?');">
                        Xóa
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="10">Chưa có sinh viên nào trong hệ thống.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}
